<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang="da" style="font-size: 100%" class="lang-da">
<head>
	<title>fcoo.dk - fcoo-application - Demo</title>
	<meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv='x-dns-prefetch-control' content='on'>

	<meta name='copyright' content='FCOO'>
	<meta name='owner' content='FCOO'>

  <link  href="bower_components.css" rel="stylesheet">	
  <link  href="../src/fcoo-application.css" rel="stylesheet">	
  <style>
    p,img {
        margin:20px;
    }
  </style>
</head>

<body>
    <div class="loading"></div>
    <p id="status"></p>
    <button onclick="demoReloadImg()">Reload image</button><br>
    <!-- <button onclick="getStatus()">Get status</button><br> -->
    <img id="img1" src="sea.jpg">
    <img id="img2" src="sea2.jpg">
    <script src="bower_components.js"></script>
	<script src="../src/fcoo-application.js"></script>
	<script>
        function demoReloadImg(){
            var random = new Date().getTime();
            $('#img1').prop('src', 'sea.jpg?param1=value1&param2=value2&_='+random);
            $('#img2').prop('src', 'sea2.jpg?_='+random);
        }


        function reloadImg( img ){
            var tempImg = new Image();
            tempImg.src = img.src;
/*
            var src = img.src;
                param = {};
                if (src.indexOf('?') > -1){
                    var srcSplit = src.split('?');
                    src = srcSplit[0];
                    param = Url.parseQuery( srcSplit[1] );
                }
                param['niels'] = new Date().getTime();
                img.src = src + '?' + Url.stringify( param );
//console.log( src + '?' + Url.stringify( param ) );
//                param = src.indexOf('?')
*/
        }

        Offline.on('up', function(){
//            var str = '';
            var imgLoad = imagesLoaded('body',/*);
            imgLoad.on( 'always', */function() {
                // detect which image is broken
                $.each( imgLoad.images, function( index, image ){
                    if (!image.isLoaded)
                        reloadImg( image.img );                
                });
//                for (var i=0; i<imgLoad.images.length; i++ ){
//                    var image = imgLoad.images[i];
//                    var result = image.isLoaded ? 'loaded' : 'broken';
//                    str = str + '<br>image is ' + result + ' for ' + image.img.src ;
//                    console.log( 'image is ' + result + ' for ' + image.img.src );
//                    if (!image.isLoaded)
//                        reloadImg( image.img );
//                }
//                $('#status').html( str );
           });
        });


        
        
        
        
        
        
        
        
        

    </script>
</body>
</html>
